# 玄学时机应用 - 技术改进方案

## 1. 概述

本文档详细描述了玄学时机应用（xuanxue）的技术改进计划，旨在提升用户体验、增强视觉效果、完善系统架构并扩展个性化功能。

## 2. 改进目标

- **用户体验 (UX)**: 提升实时性、交互反馈和个性化程度
- **用户界面 (UI)**: 优化桌面端布局，增强视觉层次和数据可视化
- **系统架构**: 引入测试、代码质量工具、错误处理和 PWA 支持
- **功能扩展**: 增加目标管理、历史记录、自定义活动和高级玄学分析

## 3. 实施路线图

### 第一阶段：核心体验与基础架构（优先级：高）

本阶段专注于夯实基础，提升应用的稳定性和基本交互体验。

#### 3.1 系统架构完善
- [x] **代码规范化**: 引入 ESLint 和 Prettier
  - 配置 `.eslintrc.js` 和 `.prettierrc`
  - 添加 `npm run lint` 和 `npm run format` 脚本
- [x] **测试框架集成**: 引入 Vitest
  - 配置 `vitest.config.js`
  - 添加 `npm run test` 脚本
  - 编写核心算法（`tyme.js`）的单元测试
- [x] **错误处理**: 
  - [x] 添加全局错误边界（Error Boundary）
  - [x] 封装统一的错误提示组件
- [x] **工程化配置**:
  - [x] 配置路径别名（已存在，需完善 IDE 支持）
  - [x] 优化构建配置

#### 3.2 核心交互优化
- [x] **实时时钟**: 
  - 添加顶部实时时钟组件
  - 实现每分钟自动刷新当前时辰高亮
- [x] **深色模式**:
  - 基于 Tailwind 颜色系统的深色模式适配
  - 添加主题切换开关
- [x] **桌面端布局优化**:
  - 重构为响应式三栏布局（左侧导航、中间内容、右侧辅助）
  - 优化宽屏下的空间利用率

### 第二阶段：个性化与数据增强（优先级：中）

本阶段专注于提升用户的个性化体验和数据价值。

#### 3.3 个性化功能
- [x] **自定义活动库**:
  - 允许用户添加/编辑/删除活动
  - 支持为活动设置图标和颜色
- [x] **目标管理**:
  - 添加"今日目标"设置功能
  - 根据能量分布自动推荐目标的最佳执行时段
- [x] **数据持久化升级**:
  - [x] 优化 LocalStorage 存储结构
  - [x] 添加数据导出（JSON）和导入功能

#### 3.4 数据可视化增强
- [x] **高级图表**:
  - 引入 ECharts 或 Chart.js
  - 优化 24 小时能量柱状图（添加趋势曲线）
  - 实现五行能量雷达图
- [x] **视觉反馈**:
  - [x] 添加加载状态（Skeleton Screen）
  - [x] 优化按钮和交互元素的微动画

### 第三阶段：高级功能与生态（优先级：低）

本阶段专注于功能的深度扩展和应用生态建设。

#### 3.5 高级玄学功能
- [x] **多维度分析**:
  - [x] 添加周/月能量趋势图
  - [x] 实现多日视图切换
- [x] **深度命理**:
  - [x] 增加冲煞提示
  - [x] 增加神煞分析（贵人、桃花等）
- [ ] **智能提醒**:
  - 实现浏览器通知功能
  - 设置特定时辰或能量变化的提醒

#### 3.6 PWA 与移动端优化
- [ ] **PWA 支持**:
  - 配置 `vite-plugin-pwa`
  - 添加 Manifest 和 Service Worker
  - 实现离线访问能力
- [ ] **移动端手势**:
  - 优化触摸滑动体验
  - 适配移动端原生操作习惯

## 4. 技术栈选型

| 类别 | 当前方案 | 推荐方案 | 说明 |
|------|----------|----------|------|
| **框架** | Vue 3 | Vue 3 | 保持不变 |
| **状态管理** | Pinia | Pinia | 保持不变 |
| **构建工具** | Vite | Vite | 保持不变 |
| **样式** | CSS | CSS + Tailwind (概念) | 保持 CSS，但引入 CSS 变量实现主题 |
| **玄学库** | tyme4ts | tyme4ts | 保持不变 |
| **测试** | 无 | **Vitest** + Vue Test Utils | 新增，用于单元和组件测试 |
| **代码规范** | 无 | **ESLint** + **Prettier** | 新增，保证代码质量 |
| **图标** | 无 | **Heroicons** / **Lucide** | 新增，提升视觉效果 |
| **图表** | 手写 CSS | **ECharts** (按需引入) | 新增，用于复杂可视化 |
| **工具库** | 无 | **VueUse** | 新增，用于通用 Composition API |
| **通知** | 无 | **vue-toastification** | 新增，用于消息提示 |

## 5. 详细设计：桌面端三栏布局

为了充分利用桌面端的大屏优势，我们将采用以下布局结构：

```
+---------------------------------------------------------------+
|                        Header (全宽)                          |
|  Logo  |  实时时钟 & 日期  |  当前时辰提示  |  主题切换  |  用户  |
+---------------------------------------------------------------+
|           |                                       |           |
|  左侧栏    |             中间主内容区              |   右侧栏   |
| (250px)   |              (Flex Grow)              |  (300px)  |
|           |                                       |           |
|  [导航]   |  [能量概览]                           | [辅助信息]  |
|  - 今日   |  - 24小时能量趋势图 (大图)             | - 五行雷达 |
|  - 本周   |  - 当前时辰高亮                       | - 喜用神   |
|  - 分析   |                                       | - 忌神     |
|  - 档案   |  [时辰详情]                           |           |
|           |  - 时辰干支、五行                     | [快捷工具]  |
|  [今日]   |  - 能量评分、吉凶描述                 | - 倒计时   |
|  - 目标   |  - 宜/忌活动清单                      | - 运势     |
|  - 待办   |                                       |           |
|           |  [智能建议]                           |           |
|           |  - 根据目标推荐的时段                 |           |
|           |                                       |           |
+-----------+---------------------------------------+-----------+
```

## 6. 数据结构更新规划

为了支持个性化功能，Store 中的数据结构需要进行如下扩展：

```javascript
// userStore 扩展
state: {
  // ... 原有字段
  customActivities: [
    { id: 'coding', label: '写代码', icon: 'code', category: 'work' },
    { id: 'reading', label: '阅读', icon: 'book', category: 'study' }
  ],
  goals: {
    '2024-01-31': [
      { id: 1, activityId: 'coding', duration: 120, status: 'pending' }
    ]
  },
  history: [
    { timestamp: 1706668800000, activityId: 'meeting', energyScore: 85 }
  ]
}
```

## 7. 风险评估

- **性能风险**: 引入 ECharts 和复杂计算可能会影响低端设备性能。
  - *对策*: 按需加载图表库，使用 Web Worker 处理复杂玄学计算。
- **兼容性风险**: PWA 和某些 CSS 新特性在旧浏览器上可能不支持。
  - *对策*: 做好降级处理，保证核心功能在所有环境可用。
- **数据迁移**: 数据结构变更可能导致旧版本 LocalStorage 数据不兼容。
  - *对策*: 实现数据版本控制和迁移脚本。

## 8. 下一步行动

1. 初始化 ESLint 和 Prettier 配置。
2. 安装并配置 Vitest。
3. 重构 CSS 变量以支持深色模式。
4. 开始重构布局组件。
